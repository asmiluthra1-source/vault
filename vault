<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin — The Vault</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cinzel:wght@400;600&family=Courier+Prime&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #050000;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-family: 'Cinzel', serif;
    color: #fff;
    padding: 2rem;
  }
  #loginScreen { width: 100%; max-width: 420px; }
  #adminScreen { width: 100%; max-width: 700px; display: none; }
  .box {
    background: rgba(10,0,0,0.95);
    border: 1px solid rgba(192,57,43,0.3);
    border-radius: 6px;
    padding: 2.5rem;
    box-shadow: 0 0 40px rgba(192,57,43,0.1);
  }
  h1 { font-family: 'Cinzel Decorative', serif; color: #c0392b; font-size: 1.1rem; letter-spacing: 0.2em; margin-bottom: 0.4rem; text-align: center; }
  .sub { color: rgba(240,192,64,0.4); font-size: 0.6rem; letter-spacing: 0.3em; text-align: center; margin-bottom: 2rem; text-transform: uppercase; }
  input[type="password"] {
    width: 100%;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(192,57,43,0.3);
    border-radius: 3px;
    color: #fff;
    font-family: 'Courier Prime', monospace;
    font-size: 0.9rem;
    padding: 0.7rem 1rem;
    outline: none;
    transition: border-color 0.3s;
  }
  input[type="password"]:focus { border-color: #c0392b; }
  .btn {
    width: 100%;
    margin-top: 0.8rem;
    background: linear-gradient(135deg,#6b0000,#c0392b);
    border: none;
    border-radius: 3px;
    color: #fff;
    font-family: 'Cinzel', serif;
    font-size: 0.7rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    padding: 0.7rem;
    cursor: pointer;
    transition: all 0.3s;
  }
  .btn:hover { background: linear-gradient(135deg,#8b0000,#e74c3c); }
  .err { color: #e74c3c; font-size: 0.65rem; margin-top: 0.5rem; text-align: center; }
  .admin-title { font-family: 'Cinzel Decorative', serif; color: #c0392b; text-align: center; font-size: 1rem; letter-spacing: 0.2em; margin-bottom: 0.3rem; }
  .admin-sub { color: rgba(240,192,64,0.4); font-size: 0.55rem; letter-spacing: 0.3em; text-align: center; margin-bottom: 1.5rem; text-transform: uppercase; }
  .status-bar {
    border: 1px solid rgba(192,57,43,0.2);
    border-radius: 3px;
    padding: 0.6rem 1rem;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    text-align: center;
    margin-bottom: 1rem;
  }
  .all-btns { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
  .all-btns .btn { width: auto; flex: 1; padding: 0.5rem; font-size: 0.55rem; margin-top: 0; }
  .btn-green { background: linear-gradient(135deg,#1a5c2a,#2ecc71) !important; }
  .btn-green:hover { background: linear-gradient(135deg,#1e6b31,#27ae60) !important; }
  .teams-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.8rem; margin-bottom: 1.5rem; }
  .team-card {
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(192,57,43,0.2);
    border-radius: 4px;
    padding: 1rem 1.2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: border-color 0.3s, background 0.3s;
  }
  .team-card.granted { border-color: rgba(46,204,113,0.5); background: rgba(46,204,113,0.05); }
  .team-name { font-size: 0.75rem; letter-spacing: 0.15em; color: #ddd; text-transform: uppercase; }
  .team-pair { font-size: 0.5rem; color: rgba(240,192,64,0.4); margin-top: 0.2rem; }
  .toggle-btn {
    background: linear-gradient(135deg,#1a5c2a,#2ecc71);
    border: none; border-radius: 2px; color: #fff;
    font-family: 'Cinzel', serif; font-size: 0.55rem;
    letter-spacing: 0.1em; text-transform: uppercase;
    padding: 0.35rem 0.8rem; cursor: pointer;
    transition: all 0.3s;
  }
  .toggle-btn.revoke { background: linear-gradient(135deg,#6b0000,#c0392b); }
  .status-badge { font-size: 0.5rem; letter-spacing: 0.15em; padding: 0.2rem 0.5rem; border-radius: 2px; text-transform: uppercase; margin-right: 0.4rem; }
  .badge-granted { color: #2ecc71; }
  .badge-denied { color: #e74c3c; }
  hr { border: none; border-top: 1px solid rgba(192,57,43,0.15); margin: 1.2rem 0; }
  .note { font-size: 0.6rem; color: rgba(255,255,255,0.3); text-align: center; letter-spacing: 0.08em; line-height: 1.8; }
  .saving { color: rgba(240,192,64,0.6); font-size: 0.55rem; text-align: center; min-height: 1rem; letter-spacing: 0.1em; margin-top: 0.5rem; }
</style>
</head>
<body>

<div id="loginScreen">
  <div class="box">
    <h1>Admin Access</h1>
    <div class="sub">The Vault — Control Panel</div>
    <input type="password" id="pwInput" placeholder="Enter admin password..." />
    <button class="btn" onclick="login()">Enter</button>
    <div class="err" id="loginErr"></div>
  </div>
</div>

<div id="adminScreen">
  <div class="box">
    <div class="admin-title">Team Access Control</div>
    <div class="admin-sub">Changes sync instantly across all devices</div>
    <div class="status-bar" id="statusBar">Loading...</div>
    <div class="all-btns">
      <button class="btn btn-green" onclick="grantAll()">✓ Grant All</button>
      <button class="btn" onclick="revokeAll()">✕ Revoke All</button>
    </div>
    <div class="teams-grid" id="teamsGrid"></div>
    <div class="saving" id="savingMsg"></div>
    <hr>
    <div class="note">Changes are pushed to JSONBin and sync instantly to all devices.<br>Teams are denied by default until you grant them access.</div>
  </div>
</div>

<script>
  const ADMIN_PASSWORD = 'cisp1212';
  const BIN_ID = '699594c1d0ea881f40c39831';
  const API_KEY = '$2a$10$HVtQW0Gb5VNTb1vcKoPQYevVO.wsIZgcYVsHkfTtiYggPm1j8lHEq';

  const TEAMS_LIST = [
    { name: 'KARMORA', pair: 'Pair 1' },
    { name: 'VASTANO', pair: 'Pair 1' },
    { name: 'OMERTA', pair: 'Pair 2' },
    { name: 'LA SIERRA', pair: 'Pair 2' },
    { name: 'STRADANERA', pair: 'Pair 3' },
    { name: 'KUROKAI', pair: 'Pair 3' },
  ];

  let approvedTeams = [];
  let saving = false;

  function login() {
    if (document.getElementById('pwInput').value === ADMIN_PASSWORD) {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('adminScreen').style.display = 'block';
      loadFromBin();
    } else {
      document.getElementById('loginErr').textContent = 'Incorrect password.';
    }
  }
  document.getElementById('pwInput').addEventListener('keydown', e => { if (e.key === 'Enter') login(); });

  async function loadFromBin() {
    document.getElementById('statusBar').textContent = 'Syncing...';
    try {
      const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
        headers: { 'X-Master-Key': API_KEY }
      });
      const data = await res.json();
      approvedTeams = (data.record.approved || []).map(t => t.toUpperCase());
    } catch(e) {
      approvedTeams = [];
    }
    renderGrid();
    updateStatusBar();
  }

  async function saveToBin() {
    if (saving) return;
    saving = true;
    document.getElementById('savingMsg').textContent = 'Saving...';
    try {
      await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'X-Master-Key': API_KEY
        },
        body: JSON.stringify({ approved: approvedTeams })
      });
      document.getElementById('savingMsg').textContent = '✓ Saved & synced!';
      setTimeout(() => document.getElementById('savingMsg').textContent = '', 2000);
    } catch(e) {
      document.getElementById('savingMsg').textContent = '⚠ Save failed — check connection';
    }
    saving = false;
  }

  function renderGrid() {
    const grid = document.getElementById('teamsGrid');
    grid.innerHTML = '';
    TEAMS_LIST.forEach(team => {
      const granted = approvedTeams.includes(team.name);
      const card = document.createElement('div');
      card.className = 'team-card ' + (granted ? 'granted' : '');
      card.innerHTML = `
        <div>
          <div class="team-name">${team.name}</div>
          <div class="team-pair">${team.pair}</div>
        </div>
        <div style="display:flex;align-items:center">
          <span class="status-badge ${granted ? 'badge-granted' : 'badge-denied'}">${granted ? '✓ ON' : '✕ OFF'}</span>
          <button class="toggle-btn ${granted ? 'revoke' : ''}" onclick="toggle('${team.name}')">
            ${granted ? 'Revoke' : 'Grant'}
          </button>
        </div>`;
      grid.appendChild(card);
    });
  }

  function updateStatusBar() {
    const bar = document.getElementById('statusBar');
    if (approvedTeams.length === 0) {
      bar.textContent = 'All teams: Access Denied';
      bar.style.color = 'rgba(231,76,60,0.7)';
    } else {
      bar.textContent = 'Active: ' + approvedTeams.join(', ');
      bar.style.color = 'rgba(46,204,113,0.7)';
    }
  }

  function toggle(name) {
    const idx = approvedTeams.indexOf(name);
    if (idx === -1) approvedTeams.push(name);
    else approvedTeams.splice(idx, 1);<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Vault</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root { --ruby: #c0392b; --ruby-glow: #ff4444; --gold: #f0c040; }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #000;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-family: 'Cinzel', serif;
    overflow: hidden;
  }
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: radial-gradient(ellipse at 20% 50%, rgba(120,0,0,0.08) 0%, transparent 60%),
                radial-gradient(ellipse at 80% 20%, rgba(80,0,0,0.06) 0%, transparent 50%);
    pointer-events: none;
  }
  .title {
    font-family: 'Cinzel Decorative', serif;
    color: var(--gold);
    font-size: clamp(1.2rem, 3vw, 2rem);
    letter-spacing: 0.4em;
    margin-bottom: 3rem;
    text-shadow: 0 0 30px rgba(240,192,64,0.4);
    animation: titlePulse 4s ease-in-out infinite;
  }
  @keyframes titlePulse { 0%,100%{opacity:.5} 50%{opacity:.85} }
  .scene {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-height: 320px;
  }
  .chest-wrapper {
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    user-select: none;
    transition: transform 0.2s;
  }
  .chest-wrapper:hover { transform: scale(1.04); }
  .chest-wrapper:active { transform: scale(0.97); }
  .chest-svg {
    width: 200px;
    filter: drop-shadow(0 0 18px rgba(240,192,64,0.25));
    transition: filter 0.3s;
  }
  .chest-wrapper:hover .chest-svg { filter: drop-shadow(0 0 30px rgba(240,192,64,0.5)); }
  .chest-label {
    margin-top: 1rem;
    color: rgba(240,192,64,0.5);
    font-size: 0.7rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    animation: blink 2.5s ease-in-out infinite;
  }
  @keyframes blink { 0%,100%{opacity:.3} 50%{opacity:.8} }
  .ruby {
    position: absolute;
    left: 50%; top: 50%;
    transform: translate(-50%,-50%) scale(0);
    cursor: pointer;
    opacity: 0;
    transition: transform 0.5s cubic-bezier(0.34,1.56,0.64,1), opacity 0.4s;
    z-index: 10;
  }
  .ruby.visible {
    transform: translate(-50%,-50%) scale(1);
    opacity: 1;
    animation: rubyFloat 3s ease-in-out infinite, rubyGlow 2s ease-in-out infinite alternate;
  }
  @keyframes rubyFloat {
    0%,100%{transform:translate(-50%,-60%) scale(1)}
    50%{transform:translate(-50%,-80%) scale(1)}
  }
  @keyframes rubyGlow {
    0%{filter:drop-shadow(0 0 15px var(--ruby-glow)) drop-shadow(0 0 30px rgba(255,0,0,0.4))}
    100%{filter:drop-shadow(0 0 30px #ff6666) drop-shadow(0 0 60px rgba(255,50,50,0.7))}
  }
  .panel {
    position: absolute;
    right: calc(50% + 130px);
    top: 50%;
    transform: translateY(-50%) translateX(-20px) scale(0.9);
    background: rgba(5,0,0,0.95);
    border: 1px solid rgba(192,57,43,0.4);
    border-radius: 4px;
    padding: 2rem 1.8rem;
    width: 260px;
    opacity: 0;
    pointer-events: none;
    transition: all 0.4s cubic-bezier(0.34,1.2,0.64,1);
    box-shadow: 0 0 40px rgba(192,57,43,0.2);
    z-index: 20;
  }
  .panel.visible {
    opacity: 1;
    pointer-events: all;
    transform: translateY(-50%) translateX(0) scale(1);
  }
  .panel-title {
    color: var(--ruby);
    font-family: 'Cinzel Decorative', serif;
    font-size: 0.65rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    margin-bottom: 1.2rem;
    text-align: center;
  }
  .panel input {
    width: 100%;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(192,57,43,0.3);
    border-radius: 2px;
    color: #fff;
    font-family: 'Cinzel', serif;
    font-size: 0.8rem;
    padding: 0.6rem 0.8rem;
    outline: none;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    transition: border-color 0.3s;
  }
  .panel input:focus { border-color: var(--ruby); box-shadow: 0 0 12px rgba(192,57,43,0.3); }
  .panel button {
    width: 100%;
    margin-top: 0.8rem;
    background: linear-gradient(135deg,#8b0000,#c0392b);
    border: none;
    border-radius: 2px;
    color: #fff;
    font-family: 'Cinzel', serif;
    font-size: 0.7rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    padding: 0.6rem;
    cursor: pointer;
    transition: all 0.3s;
  }
  .panel button:hover { background: linear-gradient(135deg,#a00000,#e74c3c); box-shadow: 0 0 15px rgba(192,57,43,0.5); }
  .panel-msg { margin-top: 0.6rem; font-size: 0.65rem; letter-spacing: 0.1em; text-align: center; min-height: 1em; }
  .panel-msg.error { color: #e74c3c; }
  .panel-msg.success { color: #2ecc71; }
  .morse-display {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.97);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 100;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.6s;
    padding: 2rem;
  }
  .morse-display.visible { opacity: 1; pointer-events: all; }
  .morse-title {
    font-family: 'Cinzel Decorative', serif;
    color: var(--ruby);
    font-size: clamp(0.9rem,2.5vw,1.4rem);
    letter-spacing: 0.3em;
    margin-bottom: 2rem;
    text-shadow: 0 0 20px rgba(192,57,43,0.8);
  }
  .morse-codes-container { display: flex; gap: 2rem; flex-wrap: wrap; justify-content: center; max-width: 900px; }
  .morse-block {
    background: rgba(192,57,43,0.05);
    border: 1px solid rgba(192,57,43,0.25);
    border-radius: 4px;
    padding: 1.5rem 2rem;
    flex: 1;
    min-width: 280px;
    max-width: 420px;
  }
  .morse-block-label { color: rgba(240,192,64,0.6); font-size: 0.6rem; letter-spacing: 0.3em; text-transform: uppercase; margin-bottom: 1rem; text-align: center; }
  .morse-text {
    color: #ff6666;
    font-family: 'Courier New', monospace;
    font-size: clamp(0.7rem,1.5vw,0.85rem);
    line-height: 2;
    text-shadow: 0 0 8px rgba(255,100,100,0.6);
    white-space: pre-wrap;
    text-align: center;
  }
  .close-btn {
    margin-top: 2.5rem;
    background: transparent;
    border: 1px solid rgba(192,57,43,0.4);
    color: rgba(192,57,43,0.7);
    font-family: 'Cinzel', serif;
    font-size: 0.65rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    padding: 0.6rem 2rem;
    cursor: pointer;
    border-radius: 2px;
    transition: all 0.3s;
  }
  .close-btn:hover { background: rgba(192,57,43,0.1); color: var(--ruby); }
  .spark {
    position: fixed;
    width: 4px; height: 4px;
    border-radius: 50%;
    pointer-events: none;
    z-index: 999;
    animation: sparkFly 0.8s forwards ease-out;
  }
  @keyframes sparkFly {
    0%{transform:translate(0,0) scale(1);opacity:1}
    100%{transform:translate(var(--dx),var(--dy)) scale(0);opacity:0}
  }
</style>
</head>
<body>

<div class="title">The Vault</div>

<div class="scene">
  <div class="panel" id="panel">
    <div class="panel-title">Identify Yourself</div>
    <input type="text" id="teamInput" placeholder="Enter team name..." autocomplete="off" />
    <button onclick="checkTeam()">Access</button>
    <div class="panel-msg" id="panelMsg"></div>
  </div>

  <div class="chest-wrapper" id="chestWrapper" onclick="openChest(event)">
    <svg class="chest-svg" viewBox="0 0 200 160" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="100" cy="155" rx="70" ry="6" fill="rgba(0,0,0,0.5)"/>
      <rect x="20" y="90" width="160" height="65" rx="4" fill="#3d1f00"/>
      <rect x="20" y="90" width="160" height="65" rx="4" fill="none" stroke="#8B6914" stroke-width="2"/>
      <line x1="20" y1="110" x2="180" y2="110" stroke="#2a1500" stroke-width="1.5"/>
      <line x1="20" y1="128" x2="180" y2="128" stroke="#2a1500" stroke-width="1.5"/>
      <path d="M18 90 Q18 55 100 52 Q182 55 182 90 Z" fill="#4a2500"/>
      <path d="M18 90 Q18 55 100 52 Q182 55 182 90 Z" fill="none" stroke="#8B6914" stroke-width="2"/>
      <rect x="20" y="105" width="160" height="8" rx="1" fill="#8B6914" opacity="0.7"/>
      <rect x="20" y="130" width="160" height="8" rx="1" fill="#8B6914" opacity="0.7"/>
      <path d="M18 85 Q18 68 100 65 Q182 68 182 85" fill="none" stroke="#8B6914" stroke-width="7" opacity="0.7"/>
      <rect x="83" y="82" width="34" height="26" rx="3" fill="#8B6914"/>
      <rect x="83" y="82" width="34" height="26" rx="3" fill="none" stroke="#f0c040" stroke-width="1"/>
      <circle cx="100" cy="92" r="5" fill="#3d1f00"/>
      <rect x="97" y="92" width="6" height="8" rx="1" fill="#3d1f00"/>
      <circle cx="30" cy="100" r="4" fill="#8B6914"/><circle cx="170" cy="100" r="4" fill="#8B6914"/>
      <circle cx="30" cy="145" r="4" fill="#8B6914"/><circle cx="170" cy="145" r="4" fill="#8B6914"/>
      <circle cx="30" cy="75" r="3.5" fill="#8B6914"/><circle cx="170" cy="75" r="3.5" fill="#8B6914"/>
      <path d="M80 62 Q100 50 120 62" fill="none" stroke="#8B6914" stroke-width="5" stroke-linecap="round"/>
    </svg>
    <div class="chest-label" id="chestLabel">Click to open</div>
  </div>

  <div class="ruby" id="ruby" onclick="showPanel()">
    <svg width="70" height="70" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="rubyGrad" cx="35%" cy="30%">
          <stop offset="0%" stop-color="#ff8080"/>
          <stop offset="40%" stop-color="#c0392b"/>
          <stop offset="100%" stop-color="#6b0000"/>
        </radialGradient>
      </defs>
      <polygon points="50,5 90,35 75,95 25,95 10,35" fill="url(#rubyGrad)"/>
      <polygon points="50,5 90,35 50,45" fill="rgba(255,180,180,0.3)"/>
      <polygon points="50,5 10,35 50,45" fill="rgba(255,100,100,0.15)"/>
      <polygon points="50,45 90,35 75,95" fill="rgba(0,0,0,0.2)"/>
      <polygon points="50,45 10,35 25,95" fill="rgba(0,0,0,0.1)"/>
      <ellipse cx="38" cy="28" rx="10" ry="6" fill="rgba(255,255,255,0.4)" transform="rotate(-20,38,28)"/>
      <polygon points="50,5 90,35 75,95 25,95 10,35" fill="none" stroke="rgba(255,150,150,0.5)" stroke-width="1.5"/>
    </svg>
  </div>
</div>

<div class="morse-display" id="morseDisplay">
  <div class="morse-title">⬡ Transmission Received ⬡</div>
  <div class="morse-codes-container">
    <div class="morse-block">
      <div class="morse-block-label">— Signal Alpha —</div>
      <div class="morse-text" id="morse1"></div>
    </div>
    <div class="morse-block">
      <div class="morse-block-label">— Signal Beta —</div>
      <div class="morse-text" id="morse2"></div>
    </div>
  </div>
  <button class="close-btn" onclick="closeMorse()">✕ Close Transmission</button>
</div>

<script>
  const BIN_ID = '699594c1d0ea881f40c39831';
  const API_KEY = '$2a$10$HVtQW0Gb5VNTb1vcKoPQYevVO.wsIZgcYVsHkfTtiYggPm1j8lHEq';

  const TEAMS = {
    'KARMORA': {
      code1: `...- .. -. .- -.-- .- -.- /\n.- -.-. - .. ...- .- - . -.. /\n... -.-- -. -.-. /\n--- ...- . .-. .-. .. -.. . /\n-.-. .-.. --- -.-. -.- /\n--- ..-. ..-. ... . - /\n-... .-.. ..- . .--. .-. .. -. - ... /\n-- --- ...- . -.. /\n.-.. .. ...- .`,
      code2: `-... .- -.-. -.- ..- .--. /\n... . .-. ...- . .-. /\n- .-. .. --. --. . .-. . -.. /\n.-.. . --. .- -.-. -.-- /\n... -.-- ... - . -- /\n. .-. .-. --- .-. /\n.- ..- - .... --- .-. .. --.. . -.. /\n.-. . -.-. --- ...- . .-. -.-- /\n-. --- -.. .`
    },
    'VASTANO': {
      code1: `...- .. -. .- -.-- .- -.- /\n.- -.-. - .. ...- .- - . -.. /\n... -.-- -. -.-. /\n--- ...- . .-. .-. .. -.. . /\n-.-. .-.. --- -.-. -.- /\n--- ..-. ..-. ... . - /\n-... .-.. ..- . .--. .-. .. -. - ... /\n-- --- ...- . -.. /\n.-.. .. ...- .`,
      code2: `-... .- -.-. -.- ..- .--. /\n... . .-. ...- . .-. /\n- .-. .. --. --. . .-. . -.. /\n.-.. . --. .- -.-. -.-- /\n... -.-- ... - . -- /\n. .-. .-. --- .-. /\n.- ..- - .... --- .-. .. --.. . -.. /\n.-. . -.-. --- ...- . .-. -.-- /\n-. --- -.. .`
    },
    'OMERTA': {
      code1: `...- --- .-.. -.- --- ...- /\n..-. .- -.-. .. -. -- /\n-.-. --- ..- -. - . .-. ..-. . .. - /\n-.-. .... .- .-. --. . ... /\n- .-- --- /\n..-. .- -- .. .-.. -.-- /\n-- . -- -... . .-. ... /\n.--- .- .. .-.. . -.. /\n-... .- .. .-.. /\n.-. . --.- ..- .. .-. . ... /\n...- . .-. .. ..-. .. . -.. /\n-.-. ..- .-. .-. . -. -.-. -.--`,
      code2: `...- .- -. -.-. . /\n-... .- -. -.- .-. ..- .--. - /\n..-. ..- -. -.. . -.. /\n-... -.-- /\n... -.-- -. -.. .. -.-. .- - . /\n... -.-- -. -.. .. -.-. .- - . /\n- .- .-. --. . - .. -. --. /\n-.-. .-. --- .-- -.`
    },
    'LA SIERRA': {
      code1: `...- --- .-.. -.- --- ...- /\n..-. .- -.-. .. -. -- /\n-.-. --- ..- -. - . .-. ..-. . .. - /\n-.-. .... .- .-. --. . ... /\n- .-- --- /\n..-. .- -- .. .-.. -.-- /\n-- . -- -... . .-. ... /\n.--- .- .. .-.. . -.. /\n-... .- .. .-.. /\n.-. . --.- ..- .. .-. . ... /\n...- . .-. .. ..-. .. . -.. /\n-.-. ..- .-. .-. . -. -.-. -.--`,
      code2: `...- .- -. -.-. . /\n-... .- -. -.- .-. ..- .--. - /\n..-. ..- -. -.. . -.. /\n-... -.-- /\n... -.-- -. -.. .. -.-. .- - . /\n... -.-- -. -.. .. -.-. .- - . /\n- .- .-. --. . - .. -. --. /\n-.-. .-. --- .-- -.`
    },
    'STRADANERA': {
      code1: `... - .- - . /\n.- .-.. .-.. . --. . ... /\n-.-. --- .-. - . --.. /\n.. -. .. - .. .- - . -.. /\n- .-- --- /\n-.- . -.-- /\n--- ...- . .-. .-. .. -.. . /\n... . ...- . -. - -.-- /\n... .. -..- /\n-... .. .-.. .-.. .. --- -. /\n... .. .--. .... --- -. . -.. /\n.-. . .--. .-.. .. -.-. .- - . -.. /\n.. -... .- .-. .-. .- /\n-.-. .-. . -.. . -. - .. .- .-.. ...`,
      code2: `-.. . ..-. . -. -.-. . /\n... - .- - . ... /\n--- ...- . .-. .-. .. -.. . /\n..-. --- .-.. .-.. --- .-- . -.. /\n.--. .-. --- - --- -.-. --- .-.. /\n-.-. .-. . -.. . -. - .. .- .-.. ... /\n.- ..- - .... --- .-. .. --.. . -.. /\n-. --- /\n..-. --- .-. . -. ... .. -.-. /\n.-.. .. -. -.- /\n.- .-.. --. --- .-. .. - .... -- /\n-. . ...- . .-. /\n.-. . -.-. --- ...- . .-. -.--`
    },
    'KUROKAI': {
      code1: `... - .- - . /\n.- .-.. .-.. . --. . ... /\n-.-. --- .-. - . --.. /\n.. -. .. - .. .- - . -.. /\n- .-- --- /\n-.- . -.-- /\n--- ...- . .-. .-. .. -.. . /\n... . ...- . -. - -.-- /\n... .. -..- /\n-... .. .-.. .-.. .. --- -. /\n... .. .--. .... --- -. . -.. /\n.-. . .--. .-.. .. -.-. .- - . -.. /\n.. -... .- .-. .-. .- /\n-.-. .-. . -.. . -. - .. .- .-.. ...`,
      code2: `-.. . ..-. . -. -.-. . /\n... - .- - . ... /\n--- ...- . .-. .-. .. -.. . /\n..-. --- .-.. .-.. --- .-- . -.. /\n.--. .-. --- - --- -.-. --- .-.. /\n-.-. .-. . -.. . -. - .. .- .-.. ... /\n.- ..- - .... --- .-. .. --.. . -.. /\n-. --- /\n..-. --- .-. . -. ... .. -.-. /\n.-.. .. -. -.- /\n.- .-.. --. --- .-. .. - .... -- /\n-. . ...- . .-. /\n.-. . -.-. --- ...- . .-. -.--`
    }
  };

  let chestOpened = false;

  async function getApprovedTeams() {
    try {
      const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
        headers: { 'X-Master-Key': API_KEY }
      });
      const data = await res.json();
      return (data.record.approved || []).map(t => t.toUpperCase());
    } catch(e) { return []; }
  }

  function openChest(e) {
    if (chestOpened) return;
    chestOpened = true;
    for (let i = 0; i < 18; i++) {
      const spark = document.createElement('div');
      spark.className = 'spark';
      const angle = Math.random() * Math.PI * 2;
      const dist = 60 + Math.random() * 100;
      spark.style.left = e.clientX + 'px';
      spark.style.top = e.clientY + 'px';
      spark.style.setProperty('--dx', Math.cos(angle) * dist + 'px');
      spark.style.setProperty('--dy', Math.sin(angle) * dist + 'px');
      spark.style.background = Math.random() > 0.5 ? '#f0c040' : '#ff4444';
      document.body.appendChild(spark);
      setTimeout(() => spark.remove(), 900);
    }
    setTimeout(() => {
      document.getElementById('ruby').classList.add('visible');
      document.getElementById('chestLabel').textContent = 'Click the ruby';
    }, 200);
  }

  function showPanel() {
    if (!chestOpened) return;
    document.getElementById('panel').classList.add('visible');
    setTimeout(() => document.getElementById('teamInput').focus(), 300);
  }

  async function checkTeam() {
    const input = document.getElementById('teamInput').value.trim().toUpperCase();
    const msg = document.getElementById('panelMsg');
    if (!input) { msg.className = 'panel-msg error'; msg.textContent = 'Enter a team name.'; return; }
    if (!TEAMS[input]) { msg.className = 'panel-msg error'; msg.textContent = '⛔ Unknown team.'; return; }
    msg.className = 'panel-msg'; msg.textContent = 'Verifying...';
    const approved = await getApprovedTeams();
    if (!approved.includes(input)) {
      msg.className = 'panel-msg error'; msg.textContent = '⛔ Access denied.'; return;
    }
    msg.className = 'panel-msg success'; msg.textContent = '✓ Access granted...';
    setTimeout(() => showMorse(input), 800);
  }

  document.getElementById('teamInput').addEventListener('keydown', e => { if (e.key === 'Enter') checkTeam(); });

  function showMorse(teamName) {
    document.getElementById('morse1').textContent = TEAMS[teamName].code1;
    document.getElementById('morse2').textContent = TEAMS[teamName].code2;
    document.getElementById('morseDisplay').classList.add('visible');
  }

  function closeMorse() { document.getElementById('morseDisplay').classList.remove('visible'); }
</script>
</body>
</html>

    renderGrid();
    updateStatusBar();
    saveToBin();
  }

  function grantAll() {
    approvedTeams = TEAMS_LIST.map(t => t.name);
    renderGrid(); updateStatusBar(); saveToBin();
  }

  function revokeAll() {
    approvedTeams = [];
    renderGrid(); updateStatusBar(); saveToBin();
  }
</script>
</body>
</html>
